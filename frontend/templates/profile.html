{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
    .profile-container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #f8f9fa; /* Light gray background */
        border-radius: 10px; /* Rounded corners */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
    }

    .profile-info {
        display: flex;
        align-items: center;
        padding-bottom: 20px; /* Space below profile section */
        border-bottom: 1px solid #e9ecef; /* Bottom border */
    }

    .profile-info img {
        margin-right: 16px; /* More space between image and username */
        border-radius: 50%; /* Circular image */
    }

    .profile-details {
        flex: 1;
    }

    .profile-details h4 {
        margin: 0;
        font-size: 1.5em; /* Larger font size */
    }

    .profile-edit-form {
        margin-top: 20px;
    }

    .profile-edit-form label {
        font-weight: bold;
        margin-top: 10px;
    }

    .profile-edit-form button {
        margin-top: 15px;
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
    }

    .profile-edit-form button:hover {
        background-color: #0056b3; /* Darker shade on hover */
    }

    .category-list,
    .product-list {
        list-style-type: none; /* Remove default bullet points */
        padding: 0;
    }

    .category-list li,
    .product-list li {
        padding: 10px 0;
        border-bottom: 1px solid #e9ecef;
    }

    .category-list li a {
        color: #007bff;
        text-decoration: none;
    }

    .category-list li a:hover {
        text-decoration: underline;
    }

    .product-list img {
        margin-left: 10px;
        border-radius: 5px; /* Rounded corners for product images */
    }

    .edit-profile-button {
        display: inline-block;
        margin-top: 10px;
        background-color: #007bff;
        color: white;
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 5px;
    }

    .edit-profile-button:hover {
        background-color: #0056b3;
    }
</style>

<div class="profile-container">
    {% if is_editing %}
        <form method="post" enctype="multipart/form-data" class="profile-edit-form">
            {% csrf_token %}
            <div>
                <label for="id_username">Username:</label>
                {{ form.username }}
            </div>

            <div>
                <label for="id_first_name">First Name:</label>
                {{ form.first_name }}
            </div>

            <div>
                <label for="id_last_name">Last Name:</label>
                {{ form.last_name }}
            </div>

            <div>
                <label for="id_profile_image">Profile Image:</label>
                {{ form.profile_image }}
            </div>
            
            <div>
                <label for="id_bio">Bio:</label>
                {{ form.bio }}
            </div>
            
            <button type="submit">Save Changes</button>
        </form>
    {% else %}
        <div class="profile-info">
            {% if user_profile.profile_image %}
                <img src="{{ user_profile.profile_image.url }}" alt="Profile Image" width="80px" height="80px">
            {% else %}
                <img src="{% static 'uploads/profile_pics/default.png' %}" alt="Default Profile Image" width="80px" height="80px">
            {% endif %}
            <div class="profile-details">
                <h4>{{ full_name }}</h4>
                <p>@{{ user.username }}</p>
                <p>{{ user.userprofile.bio }}</p>
            </div>

            <div class="mt-4">
                <a href="?show=following" class="edit-profile-button">Following</a>
                <ul class="following-list">
                {% if show_following %}
                    {% for followed_user in following_users %}
                        <li><a href="{% url 'userprofile' followed_user.user.id %}">{{ followed_user.user.username }}</a></li>
                    {% empty %}
                        <li>This user is not following anyone yet.</li>
                    {% endfor %}
            {% endif %}
                </ul>
            </div>

            <!-- Display follow/unfollow button based on whether the user is already following the profile owner -->
            {% if request.user != user_profile.user %}
                {% if user_profile in request.user.userprofile.following.all %}
                    <a href="{% url 'unfollow_user' user_profile.user.id %}" class="btn btn-danger">Unfollow</a>
                {% else %}
                    <a href="{% url 'follow_user' user_profile.user.id %}" class="btn btn-primary">Follow</a>
                {% endif %}
            {% endif %}
        </div>
        
        <div class="mt-4">
            <h5>Main Categories</h5>
            <ul class="category-list">
                {% for maincategory in maincategories %}
                    <li><a href="{% url 'category_view' maincategory.id %}">{{ maincategory.name }}</a></li>
                {% endfor %}
            </ul>
        </div>
        
        <div class="mt-4">
            <h5>Your Products</h5>
            <ul class="product-list">
                {% for product in user_products %}
                    <li>{{ product.name }} - <img src="{{ product.image.url }}" alt="{{ product.name }}" width="100"></li>
                {% empty %}
                    <li>No products added yet.</li>
                {% endfor %}
            </ul>
        </div>

        <a href="?edit=true" class="edit-profile-button">Edit Profile</a>
    {% endif %}
</div>

{% endblock %}
